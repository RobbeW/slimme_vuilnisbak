<!DOCTYPE html>
<html lang="nl">
<head>
  <!-- Voor didactisch gebruik aangepast door Robbe Wulgaert, AI in de Klas. Niet verspreiden of aanpassen zonder naamsvermelding -->
  <!-- robbewulgaert.be -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Slimme Vuilnisbak</title>
  <meta name="theme-color" content="#5200FF" />

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,700,900&display=swap" rel="stylesheet" />

  <!-- Externe CSS-bestand -->
  <link rel="stylesheet" href="./style.css" />

  <!-- Inline favicon -->
  <link rel="icon" href="data:image/svg+xml;utf8,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2064%2064'%3E%3Crect%20x='10'%20y='12'%20width='44'%20height='40'%20rx='6'%20ry='6'%20fill='%235200FF'/%3E%3Crect%20x='18'%20y='8'%20width='28'%20height='8'%20rx='4'%20ry='4'%20fill='%233dffd0'/%3E%3Cpath%20d='M24%2020v24M32%2020v24M40%2020v24'%20stroke='%23ffffff'%20stroke-width='4'%20stroke-linecap='round'/%3E%3C/svg%3E" />

  <!-- ===== Merkthema + donker modus + kleine UI-hulstijlen ===== -->
  <style>
    :root{
      /* Merk */
      --primary:#5200FF;
      --secondary:#3dffd0;

      /* Thema (licht) */
      --bg:#F9F8FC;
      --text:#110C1D;
      --surface:#ffffff;
      --border:#d6cdea;

      /* Datavis / labels */
      --chart-grid:#cfcbdc;
      --chart-label:#110C1D;
    }
    body.dark{
      --bg:#161820;
      --text:#ffffff;
      --surface:#23272e;
      --border:#3a3f4a;

      --chart-grid:#3a3f4a;
      --chart-label:#e7e7e7;
    }

    html,body{
      background:var(--bg);
      color:var(--text);
      font-family:'Roboto', system-ui, -apple-system, Segoe UI, Arial, sans-serif;
      margin:0;
    }

    /* Algemene badges/knoppen/overlays (los van bestaande mock-up CSS) */
    .statusbar{
      display:flex;
      gap:.5rem;
      flex-wrap:wrap;
      margin:.5rem 0;
    }
    .badge{
      display:inline-block;
      padding:.25rem .6rem;
      border-radius:9999px;
      border:1px solid var(--border);
      font-size:.9rem;
    }
    .badge-on { color:#1e7f33; border-color:#1e7f33; }
    .badge-off{ color:#a33;    border-color:#a33;    }

    .actions{
      display:flex;
      gap:.5rem;
      margin:.5rem 0 0;
    }
    .btn-pill{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      min-width:40px;
      height:40px;
      padding:0 .8rem;
      border-radius:9999px;
      background:var(--surface);
      color:var(--text);
      border:1px solid var(--border);
      box-shadow:0 6px 16px rgba(0,0,0,.15);
      cursor:pointer;
      text-decoration:none;
    }
    .btn-pill:focus-visible{
      outline:3px solid var(--secondary);
      outline-offset:2px;
    }

    .btn-primary{
      background:var(--primary);
      color:#ffffff;
      border:1px solid var(--primary);
    }
    .btn-primary:hover{
      filter:brightness(1.06);
    }

    .overlay.hidden,
    .privacy.hidden{
      display:none;
    }
    .overlay{
      position:fixed;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      background:rgba(0,0,0,.7);
      z-index:1000;
      padding:1rem;
    }
    .overlay-card{
      position:relative;
      background:var(--surface);
      color:var(--text);
      border:1px solid var(--border);
      border-radius:16px;
      padding:1.25rem 1.5rem;
      max-width:720px;
      width:min(92vw,720px);
    }
    .overlay-close{
      position:absolute;
      right:.75rem;
      top:.5rem;
      background:transparent;
      border:0;
      cursor:pointer;
      color:var(--text);
      font-size:1.2rem;
    }

    .privacy{
      position:fixed;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      background:rgba(0,0,0,.85);
      color:#fff;
      z-index:1100;
      text-align:center;
      padding:1rem;
    }
    .privacy p{
      font-size:1.1rem;
      margin:0;
    }

    /* Kleine layout-verbeteraars voor AIapp */
    .AIapp{
      background:var(--surface);
      color:var(--text);
      border:1px solid var(--border);
      border-radius:12px;
      padding:12px;
      margin:10px;
      box-shadow:0 8px 24px rgba(0,0,0,.1);
    }
    .AIapp h1{
      margin:.2rem 0 .6rem;
    }

    /* Uitlegvakje (rechts boven) */
    .uitleg{
      position:absolute;
      top:10vh;
      right:15vw;
      margin:0;
      max-width:420px;
      background:var(--surface);
      color:var(--text);
      border:1px solid var(--border);
      border-radius:12px;
      padding:14px;
      box-shadow:0 8px 24px rgba(0,0,0,.08);
    }
    .uitleg .btn-pill{
      margin-top:12px;
    }

    /* Footer */
    footer{
      text-align:center;
      padding:12px 8px;
    }
    footer small{
      opacity:.8;
      color:var(--text);
    }

    /* NL: Laat lijst er uitzien als H2-koppen */
    #class-list{
      list-style:none;
      padding:0;
      margin:0;
    }
    #class-list li{
      font-size:28px;
      font-weight:700;
      line-height:1.15;
      margin:10px 0;
      color:var(--text);
      letter-spacing:.2px;
    }
    #class-list li + li{
      margin-top:14px;
      border-top:0px solid var(--border);
      padding-top:14px;
    }

    /* Op kleine schermen iets kleiner */
    @media (max-width: 640px){
      #class-list li{ font-size:28px; }
    }

    /* Modal formulier-styling voor custom sessie */
    .overlay-card form{
      display:flex;
      flex-direction:column;
      gap:.75rem;
      margin-top:.25rem;
    }
    .overlay-card label{
      font-weight:600;
      font-size:.95rem;
    }
    .overlay-card input[type="text"],
    .overlay-card textarea,
    .overlay-card input[type="file"]{
      width:100%;
      border-radius:8px;
      border:1px solid var(--border);
      padding:.4rem .55rem;
      font:inherit;
      background:var(--surface);
      color:var(--text);
    }
    .overlay-card small{
      font-size:.8rem;
      opacity:.85;
    }
    .overlay-card textarea{
      min-height:90px;
      resize:vertical;
    }
    .overlay-card .actions-row{
      display:flex;
      justify-content:flex-end;
      gap:.5rem;
      margin-top:.5rem;
    }

    /* Layout overrides: app + iPhone + uitleg */
    #app{
      position:relative;
      min-height:100vh;
    }

    .container{
      position:absolute;
      top:10vh;    /* 10% onder de bovenrand */
      left:15vw;   /* 15% uit de linkerrand */
    }

    .iphone{
      transform:scale(1.1);       /* 10% groter */
      transform-origin:top left;  /* groeit naar beneden/rechts */
    }

    /* Video schaalt mee met het iPhone-scherm */
    .screen{
      position:relative;
      overflow:hidden;
    }
    .screen > video{
      position:absolute;
      top:0;
      left:0;
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
      z-index:0;
    }
    .screen .AIapp{
      position:relative;
      z-index:1;
    }
  </style>
</head>

<body>
  <main id="app">
    <div class="logoSLC" aria-hidden="true">
      <!-- Voor didactisch gebruik aangepast door Robbe Wulgaert, Sint-Lievenscollege Gent -->
    </div>

    <!-- ===== iPhone-mock-up ===== -->
    <div class="container">
      <div class="iphone">
        <div class="buttons">
          <div class="silent"></div>
          <div class="sleep"></div>
          <div class="vol-up"></div>
          <div class="vol-down"></div>
        </div>
        <div class="top">
          <div class="black-bar"></div>
          <div class="iphone-top"></div>
        </div>
        <div class="components">
          <div class="speaker"></div>
          <div class="camera">
            <div class="shine-left"></div>
            <div class="shine-right"></div>
          </div>
        </div>
        <div class="top-bar"></div>
        <div class="bottom-bar"></div>

        <div class="screen">
          <!-- Video (decor) -->
          <video loop autoplay muted playsinline>
            <source src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/1116884/iphone-vid.mp4" type="video/mp4" />
          </video>

          <!-- ===== Jouw AI-appgebied ===== -->
          <div class="AIapp">
            <h1 id="app-title"><b>Slimme Vuilnisbak</b></h1>

            <!-- Hier plaatst p5.js het canvas -->
            <div id="canvasContainer" role="img" aria-label="Live camerabeeld"></div>

            <!-- Inferentie-labels -->
            <div id="labelContainer" aria-live="polite">
              <p id="resultLabel">â€”</p>
              <p id="confidenceLabel">â€”</p>
            </div>

            <!-- Status-badges -->
            <div id="statusbar" class="statusbar">
              <span id="st-model"  class="badge badge-off">Model: niet geladen</span>
              <span id="st-camera" class="badge badge-off">Camera: niet actief</span>
              <span id="st-serial" class="badge badge-off">Serieel: niet verbonden</span>
            </div>

            <!-- Acties -->
            <div class="actions">
              <button id="btn-theme" class="btn-pill" aria-pressed="false" aria-label="Wissel thema" title="Wissel thema">ğŸŒ™</button>
              <button id="btn-help" class="btn-pill" aria-label="Toon uitleg" title="Toon uitleg">?</button>
              <button id="btn-privacy" class="btn-pill" aria-pressed="false" aria-label="Privacy-modus" title="Privacy-modus">ğŸ›‘</button>
              <button id="btn-custom-session" class="btn-pill btn-primary" aria-label="Eigen AI-model" title="Eigen AI-model">ğŸ”§ AI-model aanpassen</button>
            </div>
          </div>

          <div class="service">
            <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
          </div>
          <div class="battery">
            <div class="nub"></div>
            <div class="energy"></div>
          </div>
          <div class="lock-bar"></div>
        </div>
      </div>
    </div>

    <!-- Goo-filter voor notch-effect -->
    <svg viewBox="0 0 0 0" height="0" width="0" aria-hidden="true">
      <filter id="goo" color-interpolation-filters="sRGB">
        <feGaussianBlur in="SourceGraphic" stdDeviation="4" result="blur"></feGaussianBlur>
        <feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 8 -1" result="cm"></feColorMatrix>
        <feBlend in="SourceGraphic" in2="cm"></feBlend>
      </filter>
    </svg>

    <!-- ===== Uitlegblok + verbindknop ===== -->
    <div class="uitleg">
      <h1 id="uitleg-title">Slimme Vuilnisbak</h1>
      <button id="connectButton" class="btn-pill">Verbind met microcontroller</button>
      <ul id="class-list">
        <li>Biologisch</li>
        <li>Plastic</li>
        <li>Metaal</li>
        <li>Papier</li>
      </ul>
      <p>
        Dit is een educatief AI-prototype.<br />
        Gemaakt voor educatief gebruik door<br />
        Robbe Wulgaert (www.robbewulgaert.be).
      </p>
      <a
        href="https://www.robbewulgaert.be/contact"
        class="btn-pill btn-primary"
        target="_blank"
        rel="noopener noreferrer"
      >
        Meer info / contact
      </a>
    </div>

    <!-- ===== Help-overlay ===== -->
    <div id="overlay-help" class="overlay hidden" role="dialog" aria-modal="true" aria-labelledby="help-title">
      <div class="overlay-card">
        <button id="btn-close-help" class="overlay-close" aria-label="Sluit">âœ•</button>
        <h2 id="help-title" tabindex="-1">Instructies</h2>
        <ol>
          <li>Sta cameratoegang toe in de browser.</li>
          <li>Wijs de camera naar een object.</li>
          <li>Wacht tot het label stabiel is.</li>
          <li>(Optioneel) Klik â€œVerbind met microcontrollerâ€.</li>
          <li>Gebruik â€œPrivacy-modusâ€ om te pauzeren.</li>
          <li>Je kan jouw zelfgetrainde AI-modellen (Teachable Machine) inladen met de paarse knop.</li>
        </ol>
      </div>
    </div>

    <!-- ===== Custom-sessie & eigen model overlay ===== -->
    <div id="overlay-custom-session" class="overlay hidden" role="dialog" aria-modal="true" aria-labelledby="custom-session-title">
      <div class="overlay-card">
        <button id="btn-close-custom-session" class="overlay-close" aria-label="Sluit">âœ•</button>

        <h2 id="custom-session-title" tabindex="-1">Eigen getraind model inladen:</h2>
        <p>Pas de titel en klassen van deze sessie aan en koppel jouw eigen Teachable Machine modelbestanden.</p>

        <form id="custom-session-form">
          <div>
            <label for="custom-title">Nieuwe titel voor dit project:</label>
            <input type="text" id="custom-title" name="custom-title" placeholder="Bijvoorbeeld: Slimme Koelkast" />
          </div>

          <div>
            <label for="custom-classes">Klassen die je wilt detecteren <span style="font-weight:400;">(Ã©Ã©n per regel)</span>:</label>
            <textarea id="custom-classes" name="custom-classes" placeholder="bijv.&#10;salade&#10;tomaat&#10;kaas"></textarea>
          </div>

          <div>
            <label for="custom-tm-files">
              Teachable Machine modelbestanden
              <span title="Selecteer model.json, metadata.json en de .bin bestanden.">â“˜</span>
            </label>
            <input type="file" id="custom-tm-files" name="custom-tm-files" multiple accept=".json,.bin" />
            <small>Tip: Selecteer <code>model.json</code>, <code>metadata.json</code> en het <code>.bin</code>-bestand.</small>
          </div>

          <div class="actions-row">
            <button type="button" class="btn-pill" id="btn-cancel-custom-session">Annuleren</button>
            <button type="submit" class="btn-pill btn-primary" id="btn-apply-custom-session">Project herladen</button>
          </div>
        </form>
      </div>
    </div>

    <!-- ===== Privacy-masker ===== -->
    <div id="privacy-mask" class="privacy hidden" aria-live="polite">
      <p>ğŸ”’ Privacy-modus actief â€“ camera en AI gepauzeerd.</p>
    </div>
  </main>

  <!-- ===== Scripts ===== -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
  <script src="p5.min.js"></script>

  <!-- UI Logic -->
  <script>
    /* ===== Thema ===== */
    (function(){
      const KEY='svb-theme';
      const btn=document.getElementById('btn-theme');
      function setTheme(t){
        const dark = t==='dark';
        document.body.classList.toggle('dark', dark);
        localStorage.setItem(KEY, t);
        if(btn){
          btn.setAttribute('aria-pressed', String(dark));
          btn.textContent = dark ? 'â˜€ï¸' : 'ğŸŒ™';
        }
      }
      const stored = localStorage.getItem(KEY);
      setTheme((stored==='dark'||stored==='light') ? stored : 'light');
      btn?.addEventListener('click', ()=> setTheme(document.body.classList.contains('dark')?'light':'dark'));
    })();

    /* ===== Help ===== */
    (function(){
      const help = document.getElementById('overlay-help');
      const open = document.getElementById('btn-help');
      const close = document.getElementById('btn-close-help');
      open?.addEventListener('click', ()=> {
        help.classList.remove('hidden');
        document.getElementById('help-title')?.focus();
      });
      close?.addEventListener('click', ()=> help.classList.add('hidden'));
    })();

    /* ===== Privacy ===== */
    (function(){
      const KEY = 'sv_privacy_v1';
      const mask = document.getElementById('privacy-mask');
      const btn  = document.getElementById('btn-privacy');
      let on = localStorage.getItem(KEY) === '1';

      function apply(){
        mask.classList.toggle('hidden', !on);
        if (btn) {
          btn.setAttribute('aria-pressed', String(on));
          btn.textContent = on ? 'â–¶ï¸' : 'ğŸ›‘';
          btn.title = on ? 'Privacy uit (hervat)' : 'Privacy-modus (pauzeer)';
        }
        document.dispatchEvent(new CustomEvent('privacychange', { detail: on }));
      }

      window.isPrivacyOn = () => on;
      window.setPrivacy  = (state) => {
        on = !!state;
        localStorage.setItem(KEY, on ? '1' : '0');
        apply();
      };

      btn?.addEventListener('click', () => window.setPrivacy(!on));

      // 'p' shortcut, maar negeer invoervelden en open overlays
      document.addEventListener('keydown', (e) => {
        const key = (e.key || '').toLowerCase();
        if (key !== 'p') return;

        const target = e.target;
        const tag = (target && target.tagName) ? target.tagName.toLowerCase() : '';
        const isFormField =
          tag === 'input' ||
          tag === 'textarea' ||
          tag === 'select';

        const isEditable =
          target &&
          (target.isContentEditable ||
           target.getAttribute?.('contenteditable') === 'true');

        if (isFormField || isEditable) return;

        const overlayOpen = document.querySelector('.overlay:not(.hidden)');
        if (overlayOpen) return;

        window.setPrivacy(!on);
      });

      apply();
    })();

    /* ===== Custom Sessie + Files Handling ===== */
    (function(){
      const overlay   = document.getElementById('overlay-custom-session');
      const btnOpen   = document.getElementById('btn-custom-session');
      const btnClose  = document.getElementById('btn-close-custom-session');
      const btnCancel = document.getElementById('btn-cancel-custom-session');
      const form      = document.getElementById('custom-session-form');
      const titleInp  = document.getElementById('custom-title');
      const classesTa = document.getElementById('custom-classes');
      const filesInp  = document.getElementById('custom-tm-files');

      window.svCustomConfig = {
        title: null,
        classes: [],
        modelFile: null,
        metadataFile: null,
        weightFiles: []
      };

      function openModal(){
        overlay.classList.remove('hidden');
        setTimeout(()=> titleInp?.focus(), 50);
      }
      function closeModal(){
        overlay.classList.add('hidden');
      }
      function parseClasses(raw){
        return raw.split('\n').map(s=>s.trim()).filter(Boolean);
      }

      function extractTmFiles(fileList){
        const files = Array.from(fileList || []);
        if (!files.length) return null;

        const modelFile    = files.find(f => f.name.includes('model.json'));
        const metadataFile = files.find(f => f.name.includes('metadata.json'));
        const weightFiles  = files.filter(f => f.name.endsWith('.bin'));

        if (!modelFile || !metadataFile || weightFiles.length === 0){
          alert("Selecteer aub AL je TM-bestanden: model.json, metadata.json en de .bin bestanden.");
          return null;
        }
        return { modelFile, metadataFile, weightFiles };
      }

      function applyDomUpdates(newTitle, classes){
        if (newTitle){
          document.title = newTitle;
          const h1App = document.getElementById('app-title');
          if (h1App) h1App.textContent = newTitle;
          const h1Uitleg = document.getElementById('uitleg-title');
          if (h1Uitleg) h1Uitleg.textContent = newTitle;
        }
        if (classes && classes.length){
          const ul = document.getElementById('class-list');
          if (ul){
            ul.innerHTML = '';
            classes.forEach(cls => {
              const li = document.createElement('li');
              li.textContent = cls;
              ul.appendChild(li);
            });
          }
        }
      }

      btnOpen?.addEventListener('click', openModal);
      btnClose?.addEventListener('click', closeModal);
      btnCancel?.addEventListener('click', closeModal);
      
      form?.addEventListener('submit', (e)=>{
        e.preventDefault();
        const newTitle = (titleInp.value || '').trim();
        const classes  = parseClasses(classesTa.value || '');
        const tmFiles  = extractTmFiles(filesInp.files);

        if (!newTitle) { alert("Geef een titel op."); titleInp.focus(); return; }
        if (!classes.length) { alert("Geef minstens Ã©Ã©n klasse op."); classesTa.focus(); return; }
        if (!tmFiles) return;

        window.svCustomConfig = {
          title: newTitle,
          classes: classes,
          modelFile: tmFiles.modelFile,
          metadataFile: tmFiles.metadataFile,
          weightFiles: tmFiles.weightFiles
        };

        if (window.uiSetModel) window.uiSetModel(false);
        if (window.uiSetLabels) window.uiSetLabels('', -1);
        
        applyDomUpdates(newTitle, classes);
        document.dispatchEvent(new CustomEvent('svCustomConfigChanged', { detail: { ...window.svCustomConfig } }));
        closeModal();
      });
    })();

    /* ===== UI Setters ===== */
    (function(){
      function setBadge(id, on, txtOn, txtOff){
        const el=document.getElementById(id);
        if(!el) return;
        el.textContent = on ? txtOn : txtOff;
        el.classList.toggle('badge-on', !!on);
        el.classList.toggle('badge-off', !on);
      }
      window.uiSetModel  = (on)=> setBadge('st-model',  !!on, 'Model: geladen', 'Model: niet geladen');
      window.uiSetCamera = (on)=> setBadge('st-camera', !!on, 'Camera: actief', 'Camera: niet actief');
      window.uiSetSerial = (on)=> setBadge('st-serial', !!on, 'Serieel: verbonden', 'Serieel: niet verbonden');

      window.uiSetLabels = (label, conf)=>{
        const r=document.getElementById('resultLabel');
        const c=document.getElementById('confidenceLabel');
        if(r) r.textContent = label || 'â€”';
        if(c) c.textContent = (Number(conf) >= 0) ? (Number(conf)*100).toFixed(0)+'%' : 'â€”';
      };
    })();
  </script>

  <script src="sketch.js"></script>

  <footer class="site-footer">
    <small>Â© 2025 Robbe Wulgaert Â· AI in de Klas</small>
  </footer>
</body>
</html>
